<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ ‘çº¦</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link rel="icon" href="TB.jpg" type="image/jpg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-bg: #0a0a0a;
      --secondary-bg: #121212;
      --accent-green: #00ff8c;
      --light-green: #b8ffd9;
      --dark-green: #005a34;
      --text-light: #f0f0f0;
      --text-gray: #aaaaaa;
      --border-radius: 12px;
      --card-shadow: 0 4px 20px rgba(0, 255, 140, 0.1);
      --success: #28a745;
      --danger: #dc3545;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--primary-bg);
      color: var(--text-light);
      line-height: 1.6;
      overflow-x: hidden;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(0, 255, 140, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(0, 255, 140, 0.05) 0%, transparent 20%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
      border-bottom: 1px solid rgba(0, 255, 140, 0.2);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo h1 {
      font-size: 2rem;
      background: linear-gradient(90deg, var(--accent-green), var(--light-green));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 700;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--dark-green);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--accent-green);
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .btc-price {
      background: var(--secondary-bg);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: 600;
      border: 1px solid var(--dark-green);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btc-price .price-value {
      color: var(--accent-green);
    }

    .help-btn {
      background: var(--secondary-bg);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: var(--accent-green);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .help-btn:hover {
      background: var(--dark-green);
      transform: scale(1.1);
    }

    .connect-btn {
      background: var(--success);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 255, 140, 0.2);
    }

    .connect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 255, 140, 0.3);
    }

    .disconnect-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 255, 140, 0.2);
    }

    .disconnect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 255, 140, 0.3);
    }

    .wallet-info {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--secondary-bg);
      padding: 8px 15px;
      border-radius: 30px;
      font-size: 0.9rem;
      border: 1px solid var(--dark-green);
    }

    .wallet-address {
      color: var(--accent-green);
      font-weight: 500;
    }

    .wallet-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 20px;
      background: rgba(0, 255, 140, 0.1);
      border: 1px solid rgba(0, 255, 140, 0.3);
      font-size: 0.85rem;
    }

    .main-panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .panel {
      background: var(--secondary-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(0, 255, 140, 0.1);
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0, 255, 140, 0.1);
    }

    .panel-title h2 {
      font-size: 1.4rem;
      color: var(--accent-green);
    }

    .bet-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-gray);
      font-size: 0.9rem;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--dark-green);
      border-radius: 8px;
      color: var(--text-light);
      font-size: 1rem;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-green);
    }

    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .radio-option {
      flex: 1;
      min-width: 100px;
    }

    .radio-option input[type="radio"] {
      display: none;
    }

    .radio-option label {
      display: block;
      padding: 12px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--dark-green);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .radio-option input[type="radio"]:checked+label {
      background: var(--dark-green);
      border-color: var(--accent-green);
      color: var(--accent-green);
    }

    .bet-btn {
      grid-column: span 2;
      background: linear-gradient(90deg, var(--dark-green), #007a4d);
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 15px rgba(0, 255, 140, 0.2);
    }

    .bet-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 255, 140, 0.3);
    }

    .bets-history {
      grid-column: span 2;
    }

    .table-container {
      overflow-x: auto;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
    }

    .history-table th {
      text-align: left;
      padding: 12px 15px;
      background: rgba(0, 40, 20, 0.5);
      color: var(--accent-green);
      font-weight: 600;
    }

    .history-table td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(0, 255, 140, 0.1);
    }

    .history-table tr:hover {
      background: rgba(0, 255, 140, 0.05);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .status-pending {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }

    .status-won {
      background: rgba(0, 255, 140, 0.2);
      color: var(--accent-green);
    }

    .status-lost {
      background: rgba(255, 87, 87, 0.2);
      color: #ff5757;
    }

    .settle-btn {
      background: var(--dark-green);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .settle-btn:hover {
      background: var(--accent-green);
      color: #000;
    }

    .settle-panel {
      grid-column: span 2;
    }

    .settle-controls {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .settle-all-btn {
      background: linear-gradient(90deg, #007a4d, var(--dark-green));
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 255, 140, 0.2);
    }

    .settle-all-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 255, 140, 0.3);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--secondary-bg);
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 30px;
      position: relative;
      border: 1px solid var(--dark-green);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--accent-green);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .modal-title {
      color: var(--accent-green);
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    .rules-section {
      margin-bottom: 30px;
    }

    .rules-section h3 {
      color: var(--accent-green);
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    .rules-section p {
      margin-bottom: 15px;
      line-height: 1.7;
    }

    .odds-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .odds-table th,
    .odds-table td {
      padding: 12px 15px;
      text-align: center;
      border: 1px solid rgba(0, 255, 140, 0.1);
    }

    .odds-table th {
      background: rgba(0, 40, 20, 0.5);
      color: var(--accent-green);
    }

    .odds-table tr:nth-child(even) {
      background: rgba(0, 20, 10, 0.3);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-size: 0.9rem;
      z-index: 1001;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    .notification.success {
      background: var(--dark-green);
      border: 1px solid var(--accent-green);
    }

    .notification.error {
      background: rgba(255, 87, 87, 0.2);
      border: 1px solid #ff5757;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      display: none;
    }

    .loading-spinner {
      border: 4px solid var(--text-gray);
      border-top: 4px solid var(--accent-green);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    button:focus,
    .form-control:focus {
      outline: 2px solid var(--accent-green);
      outline-offset: 2px;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 900px) {
      .main-panels {
        grid-template-columns: 1fr;
      }

      .bet-form {
        grid-template-columns: 1fr;
      }

      .bet-btn,
      .form-group.full-width {
        grid-column: 1;
      }
    }

    @media (max-width: 600px) {
      header {
        flex-direction: column;
        gap: 15px;
      }

      .header-controls {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }

      .wallet-info {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon">ğŸŒ²</div>
        <h1>æ ‘çº¦</h1>
      </div>
      <div class="header-controls">
        <div class="btc-price">
          <span>BTCä»·æ ¼:</span>
          <span class="price-value" id="btcPrice">$--</span>
        </div>
        <button class="help-btn" id="helpBtn" aria-label="æŸ¥çœ‹è§„åˆ™">?</button>
        <button class="connect-btn" id="connectBtn" aria-label="è¿æ¥é’±åŒ…"><i class="fas fa-plug"></i> è¿æ¥é’±åŒ…</button>
        <button class="disconnect-btn hidden" id="disconnectBtn" aria-label="æ–­å¼€é’±åŒ…"><i class="fas fa-power-off"></i>
          æ–­å¼€è¿æ¥</button>
        <div class="wallet-info hidden" id="walletInfo">
          <div>
            å·²è¿æ¥ï¼š<span class="wallet-address" id="walletAddress"></span>
            <div class="wallet-badge" id="walletBadge">
              <i class="fab fa-ethereum"></i> <span id="walletName">æœªçŸ¥é’±åŒ…</span>
            </div>
          </div>
          <div>ç½‘ç»œï¼š<span id="networkInfo">æœªçŸ¥</span></div>
          <div>ä½™é¢ï¼š<span id="balanceInfo">0 BNB</span></div>
        </div>
      </div>
    </header>

    <div class="main-panels">
      <div class="panel bet-panel">
        <div class="panel-title">
          <h2>åˆ›å»ºäº‹ä»¶åˆçº¦</h2>
        </div>
        <form class="bet-form" id="betForm">
          <div class="form-group">
            <label>å¼€ä»“</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" name="direction" id="directionUp" value="up" checked>
                <label for="directionUp">å¤š </label>
              </div>
              <div class="radio-option">
                <input type="radio" name="direction" id="directionDown" value="down">
                <label for="directionDown">ç©º </label>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>ä»£å¸ç±»å‹</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" name="token" id="tokenUSDT" value="usdt" checked>
                <label for="tokenUSDT">USDT</label>
              </div>
              <div class="radio-option">
                <input type="radio" name="token" id="tokenBNB" value="bnb">
                <label for="tokenBNB">BNB</label>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>é£é™©æ¨¡å¼</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" name="mode" id="modeNormal" value="normal" checked>
                <label for="modeNormal">æ­£å¸¸æ¨¡å¼</label>
              </div>
              <div class="radio-option">
                <input type="radio" name="mode" id="modeLowRisk" value="lowRisk">
                <label for="modeLowRisk">ä½é£é™©æ¨¡å¼</label>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>ä»“ä½æ—¶é•¿é€‰æ‹©</label>
            <select class="form-control" id="durationSelect">
              <option value="1800">30åˆ†é’Ÿ</option>
              <option value="3600">1å°æ—¶</option>
              <option value="14400">4å°æ—¶</option>
              <option value="86400">1å¤©</option>
              <option value="604800">1å‘¨</option>
              <option value="2592000">1ä¸ªæœˆ</option>
            </select>
          </div>

          <div class="form-group">
            <label for="amountInput">æŠ•æ³¨é‡‘é¢</label>
            <input type="number" class="form-control" id="amountInput" placeholder="è¾“å…¥é‡‘é¢">
            <div class="min-amount" id="minAmount">æœ€ä½ä»“ä½: 20 USDT (æ­£å¸¸æ¨¡å¼) / 40 USDT (ä½é£é™©)</div>
          </div>

          <button type="submit" class="bet-btn" aria-label="æäº¤æŠ•æ³¨">ç«‹å³å¼€ä»“</button>
        </form>
      </div>

      <div class="panel bets-history">
        <div class="panel-title">
          <h2>æˆ‘çš„ä»“ä½è®°å½•</h2>
        </div>
        <div class="table-container">
          <table class="history-table">
            <thead>
              <tr>
                <th>æ—¶é—´</th>
                <th>æ–¹å‘</th>
                <th>é‡‘é¢</th>
                <th>æ—¶é•¿</th>
                <th>æ¨¡å¼</th>
                <th>çŠ¶æ€</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="betsTableBody">
              <tr>
                <td colspan="7" style="text-align: center; padding: 30px;">
                  æœªè¿æ¥é’±åŒ…æˆ–æ²¡æœ‰ä»“ä½è®°å½•
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel settle-panel">
        <div class="panel-title">
          <h2>ç»“ç®—ç®¡ç†</h2>
        </div>
        <p>ç”±äºæœåŠ¡å™¨é—®é¢˜ï¼Œå¯èƒ½å‡ºç°å·²åˆ°æœŸä½†æœªç»“ç®—çš„ä»“ä½ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨è¿›è¡Œç»“ç®—ã€‚</p>
        <div class="settle-controls">
          <button class="settle-all-btn" id="settleAllBtn" aria-label="ç»“ç®—æ‰€æœ‰åˆ°æœŸæŠ•æ³¨">ç»“ç®—æ‰€æœ‰åˆ°æœŸä»“ä½</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="rulesModal">
      <div class="modal-content">
        <button class="close-modal" id="closeModal" aria-label="å…³é—­è§„åˆ™å¼¹çª—">Ã—</button>
        <h2 class="modal-title">æ ‘çº¦</h2>
        <div class="rules-section">
          <h3>æ¦‚è¿°</h3>
          <p>"æ ‘çº¦"æ˜¯ä¸€ä¸ªåŸºäºåŒºå—é“¾çš„BTCä»·æ ¼äº‹ä»¶åˆçº¦ã€‚ç”¨æˆ·é¢„æµ‹æœªæ¥ç‰¹å®šæ—¶é—´æ®µå†…BTCä»·æ ¼æ˜¯ä¸Šæ¶¨è¿˜æ˜¯ä¸‹è·Œï¼Œå¹¶æ ¹æ®é¢„æµ‹ç»“æœè·å¾—ç›¸åº”å¥–åŠ±ã€‚</p>
        </div>
        <div class="rules-section">
          <h3>æŠ•æ³¨è§„åˆ™</h3>
          <ul>
            <li>é€‰æ‹©å¼€ä»“æ–¹å‘ï¼šçœ‹æ¶¨ï¼ˆBTCä»·æ ¼ä¸Šæ¶¨ï¼‰æˆ–çœ‹è·Œï¼ˆBTCä»·æ ¼ä¸‹è·Œï¼‰</li>
            <li>é€‰æ‹©ä»£å¸ç±»å‹ï¼šUSDT æˆ– BNB</li>
            <li>é€‰æ‹©æŠ•æ³¨æ¨¡å¼ï¼šæ­£å¸¸æ¨¡å¼ï¼ˆé«˜æ”¶ç›Šé«˜é£é™©ï¼‰æˆ–ä½é£é™©æ¨¡å¼ï¼ˆç¨³å®šæ”¶ç›Šï¼‰</li>
            <li>é€‰æ‹©é¢„æµ‹æ—¶é•¿ï¼š30åˆ†é’Ÿã€1å°æ—¶ã€4å°æ—¶ã€1å¤©ã€1å‘¨æˆ–1ä¸ªæœˆ</li>
            <li>è¾“å…¥æŠ•æ³¨é‡‘é¢ï¼šéœ€æ»¡è¶³æœ€ä½æŠ•æ³¨è¦æ±‚</li>
            <li>BTCä»·æ ¼ä»¥åŒºå—é“¾é“¾ä¸Šä»·æ ¼ä¸ºå‡†ï¼Œç»“ç®—æ—¶é—´åŒæ ·ä»¥åŒºå—é“¾ä»·æ ¼ä¸ºå‡†</li>
          </ul>
        </div>
        <div class="rules-section">
          <h3>æœ€ä½æŠ•æ³¨è¦æ±‚</h3>
          <ul>
            <li><strong>USDT</strong>: æ­£å¸¸æ¨¡å¼æœ€ä½20 USDTï¼Œä½é£é™©æ¨¡å¼æœ€ä½40 USDT</li>
            <li><strong>BNB</strong>: æœ€ä½0.05 BNBï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰</li>
          </ul>
        </div>
        <div class="rules-section">
          <h3>æ­£å¸¸æ¨¡å¼å¥–åŠ±è§„åˆ™</h3>
          <p>æ­£å¸¸æ¨¡å¼çš„å¥–åŠ±å–å†³äºç»“ç®—æ—¶çš„ä»·æ ¼æ³¢åŠ¨å¹…åº¦ï¼š</p>
          <table class="odds-table">
            <thead>
              <tr>
                <th>æ³¢åŠ¨å¹…åº¦</th>
                <th>é¢„æµ‹æ­£ç¡®å¥–åŠ±</th>
                <th>é¢„æµ‹é”™è¯¯å¥–åŠ±</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  < 0.1%</td>
                <td>0.9å€</td>
                <td>0.9å€</td>
              </tr>
              <tr>
                <td>â‰¥ 1%</td>
                <td>1.16å€</td>
                <td>0.8å€</td>
              </tr>
              <tr>
                <td>â‰¥ 3%</td>
                <td>1.24å€</td>
                <td>0.7å€</td>
              </tr>
              <tr>
                <td>â‰¥ 5%</td>
                <td>1.32å€</td>
                <td>0.6å€</td>
              </tr>
              <tr>
                <td>â‰¥ 7%</td>
                <td>1.40å€</td>
                <td>0.5å€</td>
              </tr>
              <tr>
                <td>â‰¥ 9%</td>
                <td>1.48å€</td>
                <td>0.4å€</td>
              </tr>
              <tr>
                <td>â‰¥ 11%</td>
                <td>1.56å€</td>
                <td>0.3å€</td>
              </tr>
              <tr>
                <td>â‰¥ 13%</td>
                <td>1.64å€</td>
                <td>0.2å€</td>
              </tr>
              <tr>
                <td>â‰¥ 15%</td>
                <td>1.72å€</td>
                <td>0.1å€</td>
              </tr>
              <tr>
                <td>â‰¥ 17%</td>
                <td>1.80å€</td>
                <td>0.0å€</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="rules-section">
          <h3>ä½é£é™©æ¨¡å¼å¥–åŠ±è§„åˆ™</h3>
          <ul>
            <li>é¢„æµ‹æ­£ç¡®ï¼šè·å¾—1.09å€å¥–åŠ±</li>
            <li>é¢„æµ‹é”™è¯¯ï¼šè·å¾—0.9å€è¿”è¿˜</li>
          </ul>
        </div>
        <div class="rules-section">
          <h3>ç»“ç®—è§„åˆ™</h3>
          <ul>
            <li>æŠ•æ³¨åˆ°æœŸåï¼Œæœ‰10å°æ—¶çš„ç»“ç®—çª—å£æœŸ</li>
            <li>ä»»ä½•äººéƒ½å¯ä»¥è§¦å‘ç»“ç®—ï¼ˆåŒ…æ‹¬ç©å®¶è‡ªå·±ï¼‰</li>
            <li>è¶…è¿‡ç»“ç®—çª—å£æœŸæœªç»“ç®—çš„æŠ•æ³¨å°†æ— æ³•ç»“ç®—</li>
            <li>ç»“ç®—éœ€è¦æ”¯ä»˜å°‘é‡Gasè´¹ç”¨</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
    </div>

    <script>
      // åˆçº¦åœ°å€å’ŒABI
      const contractAddress = "0xaDC1fB00539B875A7482AF18DF914bFa92Ec93f6";
      const usdtAddress = "0x55d398326f99059fF775485246999027B3197955"; // Binance-Peg USDTåœ°å€ï¼Œéœ€æ›¿æ¢ä¸ºå®é™…åœ°å€

      const contractABI = [
        "event BetPlaced(address indexed user, uint256 betIndex, bool betOnUp, bool isUsdt, bool isLowRisk, uint256 amount, uint256 duration, uint256 startPrice, uint256 startTime)",
        "event BetSettled(address indexed user, uint256 betIndex, bool won, uint256 reward, uint256 fluctuation, uint256 endPrice)",
        "function placeBet(bool _betOnUp, bool _isUsdt, bool _isLowRisk, uint256 _amount, uint256 _duration) external payable",
        "function autoSettleBatch(address[] calldata _users, uint256[] calldata _betIndices) external",
        "function getUserBets(address _user) external view returns (tuple(uint256 amount, bool betOnUp, bool isUsdt, bool isLowRisk, uint256 duration, uint256 startTime, uint256 startPrice, uint256 endPrice, bool settled)[] memory)",
        "function getPrice() public view returns (uint256)",
        "function MIN_BET_USDT() public view returns (uint256)",
        "function MIN_BET_USDT_LOW_RISK() public view returns (uint256)",
        "function MIN_BET_BNB() public view returns (uint256)"
      ];

      // å…¨å±€å˜é‡
      let provider;
      let signer;
      let contract;
      let userAddress;
      let currentWallet = null;

      // DOMå…ƒç´ 
      const connectBtn = document.getElementById('connectBtn');
      const disconnectBtn = document.getElementById('disconnectBtn');
      const walletInfo = document.getElementById('walletInfo');
      const walletAddress = document.getElementById('walletAddress');
      const walletName = document.getElementById('walletName');
      const networkInfo = document.getElementById('networkInfo');
      const balanceInfo = document.getElementById('balanceInfo');
      const btcPrice = document.getElementById('btcPrice');
      const helpBtn = document.getElementById('helpBtn');
      const rulesModal = document.getElementById('rulesModal');
      const closeModal = document.getElementById('closeModal');
      const betForm = document.getElementById('betForm');
      const amountInput = document.getElementById('amountInput');
      const minAmount = document.getElementById('minAmount');
      const tokenRadios = document.querySelectorAll('input[name="token"]');
      const modeRadios = document.querySelectorAll('input[name="mode"]');
      const betsTableBody = document.getElementById('betsTableBody');
      const settleAllBtn = document.getElementById('settleAllBtn');
      const loadingOverlay = document.getElementById('loadingOverlay');

      // æ£€æŸ¥Ethers.jsæ˜¯å¦åŠ è½½
      function checkEthers() {
        if (typeof ethers === 'undefined') {
          showNotification('Ethers.jsæœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åˆ·æ–°é¡µé¢', 'error');
          return false;
        }
        return true;
      }

      // æ˜¾ç¤ºé€šçŸ¥
      function showNotification(message, type = 'error') {
        const notification = document.createElement('div');
        notification.className = `notification ${type} show`;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      }

      // æ˜¾ç¤º/éšè—åŠ è½½åŠ¨ç”»
      function showLoading() {
        loadingOverlay.style.display = 'flex';
      }

      function hideLoading() {
        loadingOverlay.style.display = 'none';
      }

      // æ›´æ–°BTCä»·æ ¼
      async function updateBTCPrice() {
        try {
          if (!checkEthers() || !contract) {
            btcPrice.textContent = '$--';
            return;
          }
          const price = await contract.getPrice();
          const priceInUSD = ethers.utils.formatUnits(price, 18); // å‡è®¾ä»·æ ¼ä»¥18ä½å°æ•°è¿”å›
          btcPrice.textContent = `$${parseFloat(priceInUSD).toFixed(2)}`;
        } catch (error) {
          console.error("æ›´æ–°BTCä»·æ ¼å¤±è´¥:", error);
          btcPrice.textContent = '$--';
          showNotification('è·å–BTCä»·æ ¼å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åˆçº¦', 'error');
        }
      }

      // åˆå§‹åŒ–
      async function init() {
        if (!checkEthers()) return;

        // åˆå§‹åŒ–ä»·æ ¼å¹¶å¼€å§‹å®æ—¶åˆ·æ–°
        await updateBTCPrice();
        setInterval(updateBTCPrice, 1000); // æ¯ç§’åˆ·æ–°

        // è®¾ç½®æœ€ä½æŠ•æ³¨é‡‘é¢æ˜¾ç¤º
        updateMinAmountDisplay();

        // äº‹ä»¶ç›‘å¬å™¨
        connectBtn.addEventListener('click', connectWallet);
        disconnectBtn.addEventListener('click', disconnectWallet);
        helpBtn.addEventListener('click', () => rulesModal.classList.add('active'));
        closeModal.addEventListener('click', () => rulesModal.classList.remove('active'));
        betForm.addEventListener('submit', placeBetHandler);
        tokenRadios.forEach(radio => {
          radio.addEventListener('change', updateMinAmountDisplay);
        });
        modeRadios.forEach(radio => {
          radio.addEventListener('change', updateMinAmountDisplay);
        });
        settleAllBtn.addEventListener('click', settleAllBets);

        // å°è¯•è‡ªåŠ¨è¿æ¥é’±åŒ…
        await autoConnectWallet();

        // ç›‘å¬è´¦æˆ·å’Œç½‘ç»œåˆ‡æ¢
        const wallets = [
          window.okxwallet,
          window.ethereum,
          window.BinanceChain,
          window.trustwallet
        ].filter(Boolean);
        wallets.forEach(wallet => {
          wallet.on('accountsChanged', async (accounts) => {
            if (accounts.length === 0) {
              disconnectWallet();
            } else {
              await connectWithProvider(wallet, walletName.textContent || 'æœªçŸ¥é’±åŒ…');
              loadUserBets();
            }
          });
          wallet.on('chainChanged', () => {
            showNotification('ç½‘ç»œå·²åˆ‡æ¢ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…', 'error');
            disconnectWallet();
          });
        });
      }

      // è‡ªåŠ¨è¿æ¥é’±åŒ…
      async function autoConnectWallet() {
        if (!checkEthers()) return;
        const wallets = [
          { name: "OKX Wallet", id: "okx", provider: window.okxwallet },
          { name: "MetaMask", id: "metamask", provider: window.ethereum },
          { name: "å¸å®‰Web3é’±åŒ…", id: "binance", provider: window.BinanceChain },
          { name: "Trusté’±åŒ…", id: "trust", provider: window.trustwallet }
        ];

        for (const wallet of wallets) {
          if (wallet.provider && wallet.provider.selectedAddress) {
            currentWallet = wallet;
            await connectWithProvider(wallet.provider, wallet.name);
            return;
          }
        }
      }

      // è¿æ¥é’±åŒ…
      async function connectWallet() {
        if (!checkEthers()) return;
        showLoading();
        const originalText = connectBtn.innerHTML;
        connectBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ£€æµ‹é’±åŒ…...';
        connectBtn.disabled = true;

        let walletProvider = null;
        let walletName = "æœªçŸ¥é’±åŒ…";

        if (window.okxwallet) {
          walletProvider = window.okxwallet;
          walletName = "OKX Wallet";
        } else if (window.ethereum) {
          walletProvider = window.ethereum;
          walletName = "MetaMask";
        } else if (window.BinanceChain) {
          walletProvider = window.BinanceChain;
          walletName = "å¸å®‰Web3é’±åŒ…";
        } else if (window.trustwallet) {
          walletProvider = window.trustwallet;
          walletName = "Trusté’±åŒ…";
        }

        if (walletProvider) {
          try {
            await connectWithProvider(walletProvider, walletName);
            showNotification('é’±åŒ…è¿æ¥æˆåŠŸ', 'success');
          } catch (error) {
            console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
            showNotification(`è¿æ¥é’±åŒ…å¤±è´¥: ${error.message}`, 'error');
          }
        } else {
          showNotification('æœªæ£€æµ‹åˆ°å¯ç”¨é’±åŒ…ï¼Œè¯·å®‰è£…OKXã€MetaMaskã€å¸å®‰æˆ–Trusté’±åŒ…', 'error');
        }

        connectBtn.innerHTML = originalText;
        connectBtn.disabled = false;
        hideLoading();
      }

      // ä½¿ç”¨ç‰¹å®šæä¾›è€…è¿æ¥é’±åŒ…
      async function connectWithProvider(walletProvider, name) {
        if (!checkEthers()) return;
        try {
          const accounts = await walletProvider.request({ method: 'eth_requestAccounts' });
          provider = new ethers.providers.Web3Provider(walletProvider);
          signer = provider.getSigner();
          userAddress = accounts[0];

          // åˆå§‹åŒ–åˆçº¦
          contract = new ethers.Contract(contractAddress, contractABI, signer);

          // æ›´æ–°UI
          walletAddress.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
          walletName.textContent = name;
          walletInfo.classList.remove('hidden');
          connectBtn.classList.add('hidden');
          disconnectBtn.classList.remove('hidden');

          // è·å–ç½‘ç»œä¿¡æ¯
          const network = await provider.getNetwork();
          networkInfo.textContent = network.name === "unknown" ? "BSCä¸»ç½‘" : network.name;

          // è·å–ä½™é¢
          const balance = await provider.getBalance(userAddress);
          balanceInfo.textContent = ethers.utils.formatEther(balance).substring(0, 6) + " BNB";

          // åŠ è½½ç”¨æˆ·æŠ•æ³¨è®°å½•
          loadUserBets();

          // åˆå§‹åŒ–ä»·æ ¼åˆ·æ–°
          await updateBTCPrice();
        } catch (error) {
          console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
          throw error;
        }
      }

      // æ–­å¼€é’±åŒ…è¿æ¥
      function disconnectWallet() {
        userAddress = null;
        signer = null;
        provider = null;
        contract = null;
        currentWallet = null;

        // æ›´æ–°UI
        walletInfo.classList.add('hidden');
        connectBtn.classList.remove('hidden');
        disconnectBtn.classList.add('hidden');
        betsTableBody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 30px;">
              æœªè¿æ¥é’±åŒ…æˆ–æ²¡æœ‰æŠ•æ³¨è®°å½•
            </td>
          </tr>
        `;
        showNotification('é’±åŒ…å·²æ–­å¼€è¿æ¥', 'success');
      }

      // æ›´æ–°æœ€ä½æŠ•æ³¨é‡‘é¢æ˜¾ç¤º
      async function updateMinAmountDisplay() {
        if (!checkEthers() || !contract) {
          minAmount.textContent = 'è¯·è¿æ¥é’±åŒ…ä»¥æŸ¥çœ‹æœ€ä½æŠ•æ³¨é‡‘é¢';
          return;
        }
        try {
          const token = document.querySelector('input[name="token"]:checked').value;
          const mode = document.querySelector('input[name="mode"]:checked').value;
          if (token === 'usdt') {
            const min = mode === 'normal' ?
              await contract.MIN_BET_USDT() :
              await contract.MIN_BET_USDT_LOW_RISK();
            minAmount.textContent = `æœ€ä½æŠ•æ³¨: ${ethers.utils.formatUnits(min, 18)} USDT (${mode === 'normal' ? 'æ­£å¸¸æ¨¡å¼' : 'ä½é£é™©æ¨¡å¼'})`;
          } else {
            const min = await contract.MIN_BET_BNB();
            minAmount.textContent = `æœ€ä½æŠ•æ³¨: ${ethers.utils.formatUnits(min, 18)} BNB`;
          }
        } catch (error) {
          console.error('è·å–æœ€ä½æŠ•æ³¨é‡‘é¢å¤±è´¥:', error);
          minAmount.textContent = 'è·å–æœ€ä½æŠ•æ³¨é‡‘é¢å¤±è´¥';
          showNotification('è·å–æœ€ä½æŠ•æ³¨é‡‘é¢å¤±è´¥', 'error');
        }
      }

      // åŠ è½½ç”¨æˆ·æŠ•æ³¨è®°å½•
      async function loadUserBets() {
        if (!checkEthers() || !contract || !userAddress) return;
        showLoading();
        try {
          const bets = await contract.getUserBets(userAddress);
          betsTableBody.innerHTML = '';

          if (bets.length === 0) {
            betsTableBody.innerHTML = `
              <tr>
                <td colspan="7" style="text-align: center; padding: 30px;">
                  æ²¡æœ‰æ‰¾åˆ°æŠ•æ³¨è®°å½•
                </td>
              </tr>
            `;
            hideLoading();
            return;
          }

          bets.forEach((bet, index) => {
            const direction = bet.betOnUp ? "çœ‹æ¶¨ ğŸ“ˆ" : "çœ‹è·Œ ğŸ“‰";
            const token = bet.isUsdt ? "USDT" : "BNB";
            const mode = bet.isLowRisk ? "ä½é£é™©" : "æ­£å¸¸";
            const amountFormatted = ethers.utils.formatUnits(bet.amount, 18);

            const startTime = new Date(bet.startTime * 1000);
            const endTime = new Date((bet.startTime + bet.duration) * 1000);
            const timeString = `${startTime.toLocaleDateString()} ${startTime.toLocaleTimeString()}`;

            let status, statusClass, actionBtn;
            if (bet.settled) {
              const won = (bet.endPrice > bet.startPrice && bet.betOnUp) ||
                (bet.endPrice < bet.startPrice && !bet.betOnUp);
              status = won ? "å·²è·èƒœ" : "æœªè·èƒœ";
              statusClass = won ? "status-won" : "status-lost";
              actionBtn = "";
            } else {
              const now = Math.floor(Date.now() / 1000);
              if (now < bet.startTime + bet.duration) {
                status = "è¿›è¡Œä¸­";
                statusClass = "status-pending";
                actionBtn = "";
              } else if (now > bet.startTime + bet.duration + 600 * 60) {
                status = "å·²è¿‡æœŸ";
                statusClass = "status-lost";
                actionBtn = "";
              } else {
                status = "å¾…ç»“ç®—";
                statusClass = "status-pending";
                actionBtn = `<button class="settle-btn" data-index="${index}" aria-label="ç»“ç®—æŠ•æ³¨ ${index + 1}">ç»“ç®—</button>`;
              }
            }

            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${timeString}</td>
              <td>${direction}</td>
              <td>${amountFormatted} ${token}</td>
              <td>${formatDuration(bet.duration)}</td>
              <td>${mode}</td>
              <td><span class="status-badge ${statusClass}">${status}</span></td>
              <td>${actionBtn}</td>
            `;
            betsTableBody.appendChild(row);
          });

          // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨
          const oldButtons = document.querySelectorAll('.settle-btn');
          oldButtons.forEach(btn => {
            btn.replaceWith(btn.cloneNode(true));
          });

          // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
          document.querySelectorAll('.settle-btn').forEach(btn => {
            btn.addEventListener('click', () => settleBet(btn.dataset.index));
          });
        } catch (error) {
          console.error("åŠ è½½æŠ•æ³¨è®°å½•å¤±è´¥:", error);
          betsTableBody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center; padding: 30px; color: #ff5757;">
              åŠ è½½æŠ•æ³¨è®°å½•å¤±è´¥
            </td>
          </tr>
        `;
          showNotification('åŠ è½½æŠ•æ³¨è®°å½•å¤±è´¥', 'error');
        } finally {
          hideLoading();
        }
      }

      // æ ¼å¼åŒ–æ—¶é•¿
      function formatDuration(seconds) {
        if (seconds < 60) return `${seconds}ç§’`;
        if (seconds < 3600) return `${Math.floor(seconds / 60)}åˆ†é’Ÿ`;
        if (seconds < 86400) return `${Math.floor(seconds / 3600)}å°æ—¶`;
        if (seconds < 604800) return `${Math.floor(seconds / 86400)}å¤©`;
        return `${Math.floor(seconds / 604800)}å‘¨`;
      }

      // ä¸‹æ³¨å¤„ç†
      async function placeBetHandler(e) {
        e.preventDefault();
        if (!checkEthers() || !signer) {
          showNotification('è¯·å…ˆè¿æ¥é’±åŒ…!', 'error');
          return;
        }
        showLoading();
        try {
          const direction = document.querySelector('input[name="direction"]:checked').value;
          const token = document.querySelector('input[name="token"]:checked').value;
          const mode = document.querySelector('input[name="mode"]:checked').value;
          const duration = document.getElementById('durationSelect').value;
          const amount = amountInput.value;

          if (!amount || parseFloat(amount) <= 0) {
            showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ•æ³¨é‡‘é¢', 'error');
            hideLoading();
            return;
          }

          const amountWei = ethers.utils.parseUnits(amount, 18);
          const betOnUp = direction === "up";
          const isUsdt = token === "usdt";
          const isLowRisk = mode === "lowRisk";

          let tx;
          if (isUsdt) {
            const usdtContract = new ethers.Contract(
              usdtAddress,
              ['function approve(address, uint256)', 'function allowance(address, address) view returns (uint256)'],
              signer
            );
            const allowance = await usdtContract.allowance(userAddress, contractAddress);
            if (allowance.lt(amountWei)) {
              showNotification('æ­£åœ¨è¯·æ±‚USDTæˆæƒ...', 'success');
              const approveTx = await usdtContract.approve(contractAddress, amountWei);
              await approveTx.wait();
              showNotification('USDTæˆæƒæˆåŠŸ', 'success');
            }
            tx = await contract.placeBet(betOnUp, true, isLowRisk, amountWei, duration);
          } else {
            tx = await contract.placeBet(betOnUp, false, isLowRisk, amountWei, duration, { value: amountWei });
          }

          await tx.wait();
          showNotification('æŠ•æ³¨æˆåŠŸ!', 'success');
          loadUserBets();
          amountInput.value = '';
        } catch (error) {
          console.error('æŠ•æ³¨å¤±è´¥:', error);
          showNotification('æŠ•æ³¨å¤±è´¥: ' + error.message, 'error');
        } finally {
          hideLoading();
        }
      }

      // ç»“ç®—å•ç¬”æŠ•æ³¨
      async function settleBet(betIndex) {
        if (!checkEthers() || !signer || !userAddress) return;
        showLoading();
        try {
          const tx = await contract.autoSettleBatch([userAddress], [betIndex]);
          await tx.wait();
          showNotification('ç»“ç®—æˆåŠŸ!', 'success');
          loadUserBets();
        } catch (error) {
          console.error("ç»“ç®—å¤±è´¥:", error);
          showNotification('ç»“ç®—å¤±è´¥: ' + error.message, 'error');
        } finally {
          hideLoading();
        }
      }

      // ç»“ç®—æ‰€æœ‰åˆ°æœŸæŠ•æ³¨
      async function settleAllBets() {
        if (!checkEthers() || !signer || !userAddress) return;
        showLoading();
        try {
          const bets = await contract.getUserBets(userAddress);
          const now = Math.floor(Date.now() / 1000);
          const settleIndices = [];
          bets.forEach((bet, index) => {
            if (!bet.settled &&
              now >= bet.startTime + bet.duration &&
              now <= bet.startTime + bet.duration + 600 * 60) {
              settleIndices.push(index);
            }
          });

          if (settleIndices.length === 0) {
            showNotification('æ²¡æœ‰éœ€è¦ç»“ç®—çš„æŠ•æ³¨', 'error');
            hideLoading();
            return;
          }

          const users = Array(settleIndices.length).fill(userAddress);
          const tx = await contract.autoSettleBatch(users, settleIndices);
          await tx.wait();
          showNotification(`æˆåŠŸç»“ç®— ${settleIndices.length} ç¬”æŠ•æ³¨!`, 'success');
          loadUserBets();
        } catch (error) {
          console.error("æ‰¹é‡ç»“ç®—å¤±è´¥:", error);
          showNotification('æ‰¹é‡ç»“ç®—å¤±è´¥: ' + error.message, 'error');
        } finally {
          hideLoading();
        }
      }

      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      window.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>
